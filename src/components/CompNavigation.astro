---
// Imports
import { SITE_NAVIGATION, CONFIG_BASE } from "../consts";

// Component Props
const { label } = Astro.props;

// Dynamic Data & Logic
const currentUrl = new URL(Astro.request.url, import.meta.env.SITE);
let currentPath = currentUrl.pathname;

// Adjust currentPath by removing CONFIG_BASE in production
if (CONFIG_BASE && currentPath.startsWith(CONFIG_BASE)) {
  currentPath = currentPath.substring(CONFIG_BASE.length);
  // Ensure currentPath starts with a slash after adjustment
  if (!currentPath.startsWith('/')) {
    currentPath = '/' + currentPath;
  }
}

// Helper function to adjust item.url for CONFIG_BASE
function adjustUrlForConfigBase(url) {
  return CONFIG_BASE ? `${CONFIG_BASE}${url === "/" ? "" : url}` : url;
}

---

<nav aria-label={label}>
  <ul role="list" class="l-cluster">
    {SITE_NAVIGATION.map(item => {
      // Adjust item.url for CONFIG_BASE
      const adjustedItemUrl = adjustUrlForConfigBase(item.url);

      return (
        <li>
          <a 
            href={adjustedItemUrl}
            aria-current={currentPath === new URL(adjustedItemUrl, import.meta.env.SITE).pathname ? 'page' : undefined}
          >{item.label}</a>
        </li>
      );
    })}
  </ul>
</nav>